<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['controls', 'geochart', 'corechart', 'table']});
      google.charts.setOnLoadCallback(drawRegionsMap);

	  var chartWidth = 800;
	  var chartHeight = 500;

      function drawRegionsMap() {
		// query = select *
		var gid = '432197715';
		var select = "select%20*";
		var CEFDataURL = 'https://docs.google.com/spreadsheets/d/1uH_46klGqZeoDF4VyAqMa6XAzAUCwpksY8pOgvgvRlo/gviz/tq?gid='
		CEFDataURL += gid+'&headers=1&tq='+select;
		var query = new google.visualization.Query(CEFDataURL);
		query.send(handleQueryResponse_change);
		}

		function handleQueryResponse_change(response) {
				if (response.isError()) {
					alert ('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
					return;
				}

				var data = response.getDataTable();

		var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));

		/********************
        ***** SELECTORS *****
        ********************/

        var FilterCategory = new google.visualization.ControlWrapper({
            controlType: 'CategoryFilter',
            containerId: 'filter_category_div',
            options: {
              filterColumnLabel: 'Category',
			  ui: {
               allowTyping: false,
               allowMultiple: true,
               allowNone: true,
               selectedValuesLayout:'belowStacked'
             }
            },
        });

		var FilterSubcategory = new google.visualization.ControlWrapper({
            controlType: 'CategoryFilter',
            containerId: 'filter_subcategory_div',
            options: {
              filterColumnLabel: 'Subcategory',
			  ui: {
               allowTyping: false,
               allowMultiple: true,
               allowNone: true,
               selectedValuesLayout:'belowStacked'
             }
            },
        });

		var FilterInterest = new google.visualization.ControlWrapper({
            controlType: 'CategoryFilter',
            containerId: 'filter_interest_div',
            options: {
              filterColumnLabel: 'Interest',
			  ui: {
               allowTyping: false,
               allowMultiple: true,
               allowNone: true,
               selectedValuesLayout:'belowStacked'
             }
            },
        });

		// Sets chart options
		var options = {
			region: ('150'), // Europe
			colorAxis: {colors: ['#dfbf9f', '#996633']}, // colours of the countries in the data
			backgroundColor: '#ffffff', // colour of the background (the sea in this case)
			datalessRegionColor: '#e6e6e6', // colours of the countries not in the data
			view: {columns: [0, 4]},
			};

        var deploy_mapChart = new google.visualization.ChartWrapper({
				chartType: 'GeoChart',
				containerId: 'Chart_Div',
				options: options,
				view: {columns: [0, 4]},
			});

		// deploy_mapChart.setDataTable(data);

		// deploy_mapChart.draw();

	      /***** DASHBOARD *****/
      dashboard.bind([FilterCategory, FilterSubcategory,FilterInterest], [deploy_mapChart]);

	  dashboard.draw(data);
    }

    function sortDates(date1, date2) {
      if (date1 > date2) return 1;
      if (date1 < date2) return -1;
      return 0;
    }
    </script>

    
  </head>
   <body>
    <!--Div that will hold the dashboard-->
    <div id="dashboard_div" style="margin-top: 50px">
    <div class="tabs-content">
          <table>
            <tr style='vertical-align: top;'>
          <td class="dashboard-panel">
            <h1 align="left" id="main-title" style="margin-bottom:10px; padding-bottom:48px;" title=""></h1>
            <div>
                <div class="tab-content active">
                    <h5 class="chart-subtitle">Transparency Register: Europa</h5>
                    <p>This chart shows the frequency of each country, for each of the filters.</p>
                    <div id="Chart_Div" class="chart"></div>
                </div>
            </div>
          </td>
          <td class="filter-panel">
            <div class="filter_panel">
              <div id="filter_category_div" class="filter"></div>
              <div id="filter_subcategory_div" class="filter"></div>
              <div id="filter_interest_div" class="filter"></div>
            </div>
          </td>
        </tr>
      </table>
    </div>
  </body>
  </html>
